// Generated by CoffeeScript 1.3.3

/*
Copyright 2012 Marco Braak

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/

(function(){var e,t,n,r,o,i,s,u,a,h,d,p,l,c,f,_,m,g,v,y=[].slice,N={}.hasOwnProperty,w=function(e,t){for(var n in t)N.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=this.jQuery,f=function(){function t(t,n){this.$el=e(t),this.options=e.extend({},this.defaults,n),this._init()}return t.prototype.defaults={},t.prototype.destroy=function(){return this._deinit()},t.prototype._init=function(){return null},t.prototype._deinit=function(){return null},t.register=function(n,r){var o,i,s,u;return u=function(){return"simple_widget_"+r},i=function(t,r){var o;return o=u(),t.each((function(){var t;if(t=new n(this,r),!e.data(this,o))return e.data(this,o,t)})),t},s=function(n){var r;return r=u(),n.each((function(){var n;return(n=e.data(this,r))&&n instanceof t&&n.destroy(),e.removeData(this,r)}))},o=function(n,r,o){var i;return i=null,n.each((function(){var n,s;if((n=e.data(this,u()))&&n instanceof t&&(s=n[r])&&"function"==typeof s)return i=s.apply(n,o)})),i},e.fn[r]=function(){var e,t,n,r;return n=arguments[0],t=2<=arguments.length?y.call(arguments,1):[],e=this,void 0===n||"object"==typeof n?i(e,n):"string"==typeof n&&"_"!==n[0]?"destroy"===(r=n)?s(e):o(e,r,t):void 0}},t}(),this.SimpleWidget=f,a=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return w(n,t),n.is_mouse_handled=!1,n.prototype._init=function(){return this.$el.bind("mousedown.mousewidget",e.proxy(this._mouseDown,this)),this.is_mouse_started=!1},n.prototype._deinit=function(){var t;return this.$el.unbind("mousedown.mousewidget"),(t=e(document)).unbind("mousemove.mousewidget"),t.unbind("mouseup.mousewidget")},n.prototype._mouseDown=function(t){var r;if(!n.is_mouse_handled&&(this.is_mouse_started||this._mouseUp(t),1===t.which&&this._mouseCapture(t)))return this.mouse_down_event=t,(r=e(document)).bind("mousemove.mousewidget",e.proxy(this._mouseMove,this)),r.bind("mouseup.mousewidget",e.proxy(this._mouseUp,this)),t.preventDefault(),this.is_mouse_handled=!0,!0},n.prototype._mouseMove=function(e){return this.is_mouse_started?(this._mouseDrag(e),e.preventDefault()):(this.is_mouse_started=!1!==this._mouseStart(this.mouse_down_event),this.is_mouse_started?this._mouseDrag(e):this._mouseUp(e),!this.is_mouse_started)},n.prototype._mouseUp=function(t){var n;return(n=e(document)).unbind("mousemove.mousewidget"),n.unbind("mouseup.mousewidget"),this.is_mouse_started&&(this.is_mouse_started=!1,this._mouseStop(t)),!1},n.prototype._mouseCapture=function(e){return!0},n.prototype._mouseStart=function(e){return null},n.prototype._mouseDrag=function(e){return null},n.prototype._mouseStop=function(e){return null},n}(f),this.Tree={},e=this.jQuery,g=function(e,t){var n,r,o;if(e.indexOf)return e.indexOf(t);for(n=r=0,o=e.length;r<o;n=++r)if(e[n]===t)return n;return-1},this.Tree.indexOf=g,(u={}).escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,u.meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},u.quote=function(e){return u.escapable.lastIndex=0,u.escapable.test(e)?'"'+e.replace(u.escapable,(function(e){var t;return"string"==typeof(t=u.meta[e])?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+e+'"'},u.str=function(e,t){var n,r,o,i,s,a,h;switch(typeof(s=t[e])){case"string":return u.quote(s);case"number":return isFinite(s)?String(s):"null";case"boolean":case"null":return String(s);case"object":if(!s)return"null";if(o=[],"[object Array]"===Object.prototype.toString.apply(s)){for(n=a=0,h=s.length;a<h;n=++a)i=s[n],o[n]=u.str(n,s)||"null";return 0===o.length?"[]":"["+o.join(",")+"]"}for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(i=u.str(r,s))&&o.push(u.quote(r)+":"+i);return 0===o.length?"{}":"{"+o.join(",")+"}"}},v=function(e){return u.str("",{"":e})},this.Tree.toJson=v,m=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},(p={getName:function(e){return e===p.BEFORE?"before":e===p.AFTER?"after":e===p.INSIDE?"inside":"none"}}).BEFORE=1,p.AFTER=2,p.INSIDE=3,p.NONE=4,this.Tree.Position=p,h=function(){function t(e){this.setData(e)}return t.prototype.setData=function(e){var t,n;if("object"!=typeof e)this.name=e;else for(t in e)n=e[t],"label"===t?this.name=n:this[t]=n;return this.children=[],this.parent=null},t.prototype.initFromData=function(e){var n,r,o=this;return r=function(e){if(o.setData(e),e.children)return n(e.children)},n=function(e){var n,r,i,s;for(i=0,s=e.length;i<s;i++)n=e[i],(r=new t("")).initFromData(n),o.addChild(r);return null},r(e),null},t.prototype.loadFromData=function(e){var n,r,o,i;for(this.children=[],o=0,i=e.length;o<i;o++)n=new t(r=e[o]),this.addChild(n),"object"==typeof r&&r.children&&n.loadFromData(r.children);return null},t.prototype.addChild=function(e){return this.children.push(e),e._setParent(this)},t.prototype.addChildAtPosition=function(e,t){return this.children.splice(t,0,e),e._setParent(this)},t.prototype._setParent=function(e){return this.parent=e,this.tree=e.tree,this.tree.addNodeToIndex(this)},t.prototype.removeChild=function(e){return this.children.splice(this.getChildIndex(e),1),this.tree.removeNodeFromIndex(e)},t.prototype.getChildIndex=function(t){return e.inArray(t,this.children)},t.prototype.hasChildren=function(){return 0!==this.children.length},t.prototype.iterate=function(e){var t,n=this;return(t=function(r,o){var i,s,u,a,h;if(r.children){for(u=0,a=(h=r.children).length;u<a;u++)i=h[u],s=e(i,o),n.hasChildren()&&s&&t(i,o+1);return null}})(this,0),null},t.prototype.moveNode=function(e,t,n){return e.parent.removeChild(e),n===p.AFTER?t.parent.addChildAtPosition(e,t.parent.getChildIndex(t)+1):n===p.BEFORE?t.parent.addChildAtPosition(e,t.parent.getChildIndex(t)):n===p.INSIDE?t.addChildAtPosition(e,0):void 0},t.prototype.getData=function(){var e;return(e=function(t){var n,r,o,i,s,u,a;for(n=[],u=0,a=t.length;u<a;u++){for(r in i={},o=t[u])s=o[r],"parent"!==r&&"children"!==r&&"element"!==r&&"tree"!==r&&Object.prototype.hasOwnProperty.call(o,r)&&(i[r]=s);o.hasChildren()&&(i.children=e(o.children)),n.push(i)}return n})(this.children)},t.prototype.getNodeByName=function(e){var t;return t=null,this.iterate((function(n){return n.name!==e||(t=n,!1)})),t},t.prototype.addAfter=function(e){var n,r;return this.parent?(r=new t(e),n=this.parent.getChildIndex(this),this.parent.addChildAtPosition(r,n+1),r):null},t.prototype.addBefore=function(e){var n,r;return this.parent?(r=new t(e),n=this.parent.getChildIndex(this),this.parent.addChildAtPosition(r,n)):null},t.prototype.addParent=function(e){var n,r,o,i,s,u;if(this.parent){for((r=new t(e))._setParent(this.tree),i=0,s=(u=(o=this.parent).children).length;i<s;i++)n=u[i],r.addChild(n);return o.children=[],o.addChild(r),r}return null},t.prototype.remove=function(){if(this.parent)return this.parent.removeChild(this),this.parent=null},t.prototype.append=function(e){var n;return n=new t(e),this.addChild(n),n},t.prototype.prepend=function(e){var n;return n=new t(e),this.addChildAtPosition(n,0),n},t}(),_=function(e){function t(e){t.__super__.constructor.call(this,e,null,!0),this.id_mapping={},this.tree=this}return w(t,e),t.prototype.getNodeById=function(e){return this.id_mapping[e]},t.prototype.addNodeToIndex=function(e){if(e.id)return this.id_mapping[e.id]=e},t.prototype.removeNodeFromIndex=function(e){if(e.id)return delete this.id_mapping[e.id]},t}(h),this.Tree.Tree=_,s=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return w(r,t),r.prototype.defaults={autoOpen:!1,saveState:!1,dragAndDrop:!1,selectable:!1,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null,autoEscape:!0,dataUrl:null},r.prototype.toggle=function(e){return e.hasChildren()&&new o(e,this.element).toggle(),this._saveState()},r.prototype.getTree=function(){return this.tree},r.prototype.selectNode=function(e,t){return this.select_node_handler.selectNode(e,t)},r.prototype.getSelectedNode=function(){return this.selected_node||!1},r.prototype.toJson=function(){return v(this.tree.getData())},r.prototype.loadData=function(e,t){var n,r,o,i,s;if(t){for((r=new h(""))._setParent(t.tree),r.loadFromData(e),o=0,i=(s=r.children).length;o<i;o++)n=s[o],t.addChild(n);this._refreshElements(t.parent)}else this._initTree(e);if(this.is_dragging)return this.dnd_handler.refreshHitAreas()},r.prototype.getNodeById=function(e){return this.tree.getNodeById(e)},r.prototype.getNodeByName=function(e){return this.tree.getNodeByName(e)},r.prototype.openNode=function(e,t){if(e.hasChildren())return new o(e,this.element).open(null,t),this._saveState()},r.prototype.closeNode=function(e,t){if(e.hasChildren())return new o(e,this.element).close(t),this._saveState()},r.prototype.isDragging=function(){return this.is_dragging},r.prototype.refreshHitAreas=function(){return this.dnd_handler.refreshHitAreas()},r.prototype.addNodeAfter=function(e,t){var n;return n=t.addAfter(e),this._refreshElements(t.parent),n},r.prototype.addNodeBefore=function(e,t){var n;return n=t.addBefore(e),this._refreshElements(t.parent),n},r.prototype.addParentNode=function(e,t){var n;return n=t.addParent(e),this._refreshElements(n.parent),n},r.prototype.removeNode=function(e){var t;if(t=e.parent)return e.remove(),this._refreshElements(t.parent)},r.prototype.appendNode=function(e,t){var n,r;return t||(t=this.tree),n=t.hasChildren(),r=t.append(e),n?this._refreshElements(t):this._refreshElements(t.parent),r},r.prototype.prependNode=function(e,t){var n;return t||(t=this.tree),n=t.prepend(e),this._refreshElements(t),n},r.prototype._init=function(){return r.__super__._init.call(this),this.element=this.$el,this._initData(),this.element.click(e.proxy(this._click,this)),this.element.bind("contextmenu",e.proxy(this._contextmenu,this))},r.prototype._deinit=function(){return this.element.empty(),this.element.unbind(),this.tree=null,r.__super__._deinit.call(this)},r.prototype._initData=function(){var t,n=this;return this.options.data?this._initTree(this.options.data):(t=this.options.dataUrl||this.element.data("url"))?e.ajax({url:t,cache:!1,success:function(t){var r;return r=e.isArray(t)||"object"==typeof t?t:e.parseJSON(t),n._initTree(r)}}):void 0},r.prototype._initTree=function(t){var r;return this.tree=new _,this.tree.loadFromData(t),this.selected_node=null,this.save_state_handler=new l(this),this.select_node_handler=new c(this),this.dnd_handler=new n(this),this._openNodes(),this._refreshElements(),this.select_node_handler.selectCurrentNode(),r=e.Event("tree.init"),this.element.trigger(r)},r.prototype._openNodes=function(){var e;if(!(this.options.saveState&&this.save_state_handler.restoreState()||!1===this.options.autoOpen))return e=!0===this.options.autoOpen?-1:parseInt(this.options.autoOpen),this.tree.iterate((function(t,n){return t.is_open=!0,n!==e}))},r.prototype._refreshElements=function(t){var n,r,o,i,s,u,a,h,d,p=this;return null==t&&(t=null),a=function(e){return p.options.autoEscape?m(e):e},s=function(t){return e("<ul"+(t?' class="tree"':"")+"></ul>")},o=function(e){var t;return t=e.hasChildren()?r(e):i(e),p.options.onCreateLi&&p.options.onCreateLi(e,t),t},i=function(t){var n;return n=a(t.name),e('<li><div><span class="title">'+n+"</span></div></li>")},r=function(t){var n,r,o,i;return i=function(){var e;return e=["folder"],t.is_open||e.push("closed"),e.join(" ")},n=function(){var e;return e=["toggler"],t.is_open||e.push("closed"),e.join(" ")}(),o=i(),r=a(t.name),e('<li class="'+o+'"><div><a class="'+n+'">&raquo;</a><span class="title">'+r+"</span></div></li>")},u=function(e,t,n,r){var i,a,h,d,p;for(a=s(n),e.append(a),d=0,p=t.length;d<p;d++)h=t[d],i=o(h),a.append(i),h.element=i[0],i.data("node",h),h.hasChildren()&&u(i,h.children,!1,h.is_open);return null},t&&t.parent?(h=!1,(d=this._getNodeElementForNode(t)).getUl().remove(),n=d.$element):(t=this.tree,(n=this.element).empty(),h=!0),u(n,t.children,h,h)},r.prototype._click=function(t){var n,r,o,i;if(!t.ctrlKey)if((n=e(t.target)).is(".toggler")){if((i=this._getNodeElement(n))&&i.node.hasChildren())return i.toggle(),this._saveState(),t.preventDefault(),t.stopPropagation()}else if((n.is("div")||n.is("span"))&&(o=this._getNode(n))&&(!this.options.onCanSelectNode||this.options.onCanSelectNode(o)))return this.selectNode(o),(r=e.Event("tree.click")).node=o,this.element.trigger(r)},r.prototype._getNode=function(e){var t;return 0===(t=e.closest("li")).length?null:t.data("node")},r.prototype._getNodeElementForNode=function(e){return e.hasChildren()?new o(e,this.element):new d(e,this.element)},r.prototype._getNodeElement=function(e){var t;return(t=this._getNode(e))?this._getNodeElementForNode(t):null},r.prototype._contextmenu=function(t){var n,r,o;if((n=e(t.target).closest("ul.tree div")).length&&(o=this._getNode(n)))return t.preventDefault(),t.stopPropagation(),(r=e.Event("tree.contextmenu")).node=o,r.click_event=t,this.element.trigger(r),!1},r.prototype._saveState=function(){if(this.options.saveState)return this.save_state_handler.saveState()},r.prototype._mouseCapture=function(e){return!!this.options.dragAndDrop&&this.dnd_handler.mouseCapture(e)},r.prototype._mouseStart=function(e){return!!this.options.dragAndDrop&&this.dnd_handler.mouseStart(e)},r.prototype._mouseDrag=function(e){return!!this.options.dragAndDrop&&this.dnd_handler.mouseDrag(e)},r.prototype._mouseStop=function(){return!!this.options.dragAndDrop&&this.dnd_handler.mouseStop()},r.prototype.testGenerateHitAreas=function(e){return this.dnd_handler.current_item=this._getNodeElementForNode(e),this.dnd_handler.generateHitAreas(),this.dnd_handler.hit_areas},r}(a),f.register(s,"tree"),i=function(){function t(t,n,r){this.$element=n,this.node=t,this.$ghost=e('<li class="ghost"><span class="circle"></span><span class="line"></span></li>'),r===p.AFTER?this.moveAfter():r===p.BEFORE?this.moveBefore():r===p.INSIDE&&(t.hasChildren()&&t.is_open?this.moveInsideOpenFolder():this.moveInside())}return t.prototype.remove=function(){return this.$ghost.remove()},t.prototype.moveAfter=function(){return this.$element.after(this.$ghost)},t.prototype.moveBefore=function(){return this.$element.before(this.$ghost)},t.prototype.moveInsideOpenFolder=function(){return e(this.node.children[0].element).before(this.$ghost)},t.prototype.moveInside=function(){return this.$element.after(this.$ghost),this.$ghost.addClass("inside")},t}(),t=function(){function t(t){var n,r;n=t.children("div"),r=t.width()-4,this.$hint=e('<span class="border"></span>'),n.append(this.$hint),this.$hint.css({width:r,height:n.height()-4})}return t.prototype.remove=function(){return this.$hint.remove()},t}(),d=function(){function n(e,t){this.init(e,t)}return n.prototype.init=function(t,n){return this.node=t,this.tree_element=n,this.$element=e(t.element)},n.prototype.getUl=function(){return this.$element.children("ul:first")},n.prototype.getSpan=function(){return this.$element.children("div").find("span.title")},n.prototype.getLi=function(){return this.$element},n.prototype.addDropHint=function(e){return e===p.INSIDE?new t(this.$element):new i(this.node,this.$element,e)},n.prototype.select=function(){return this.getLi().addClass("selected")},n.prototype.deselect=function(){return this.getLi().removeClass("selected")},n}(),o=function(n){function r(){return r.__super__.constructor.apply(this,arguments)}return w(r,n),r.prototype.toggle=function(){return this.node.is_open?this.close():this.open()},r.prototype.open=function(t,n){var r,o=this;if(!this.node.is_open)return this.node.is_open=!0,this.getButton().removeClass("closed"),r=function(){var n;return o.getLi().removeClass("closed"),t&&t(),(n=e.Event("tree.open")).node=o.node,o.tree_element.trigger(n)},n?r():this.getUl().slideDown("fast",r)},r.prototype.close=function(t){var n,r=this;if(this.node.is_open)return this.node.is_open=!1,this.getButton().addClass("closed"),n=function(){var t;return r.getLi().addClass("closed"),(t=e.Event("tree.close")).node=r.node,r.tree_element.trigger(t)},t?n():this.getUl().slideUp("fast",n)},r.prototype.getButton=function(){return this.$element.children("div").find("a.toggler")},r.prototype.addDropHint=function(e){return this.node.is_open||e!==p.INSIDE?new i(this.node,this.$element,e):new t(this.$element)},r}(d),r=function(){function t(t,n,r,o){this.offset_x=n,this.offset_y=r,this.$element=e('<span class="title tree-dragging">'+t.name+"</span>"),this.$element.css("position","absolute"),o.append(this.$element)}return t.prototype.move=function(e,t){return this.$element.offset({left:e-this.offset_x,top:t-this.offset_y})},t.prototype.remove=function(){return this.$element.remove()},t}(),l=function(){function t(e){this.tree_widget=e}return t.prototype.saveState=function(){return this.tree_widget.options.onSetStateFromStorage?this.tree_widget.options.onSetStateFromStorage(this.getState()):"undefined"!=typeof localStorage&&null!==localStorage?localStorage.setItem(this.getCookieName(),this.getState()):e.cookie?e.cookie(this.getCookieName(),this.getState(),{path:"/"}):void 0},t.prototype.restoreState=function(){var t;return!!(t=this.tree_widget.options.onGetStateFromStorage?this.tree_widget.options.onGetStateFromStorage():"undefined"!=typeof localStorage&&null!==localStorage?localStorage.getItem(this.getCookieName()):e.cookie?e.cookie(this.getCookieName(),{path:"/"}):null)&&(this.setState(t),!0)},t.prototype.getState=function(){var e,t;return e=[],this.tree_widget.tree.iterate((function(t){return t.is_open&&t.id&&t.hasChildren()&&e.push(t.id),!0})),t="",this.tree_widget.selected_node&&(t=this.tree_widget.selected_node.id),v({open_nodes:e,selected_node:t})},t.prototype.setState=function(t){var n,r,o,i=this;if(n=e.parseJSON(t))return r=n.open_nodes,o=n.selected_node,this.tree_widget.tree.iterate((function(e){return e.id&&e.hasChildren()&&g(r,e.id)>=0&&(e.is_open=!0),o&&e.id===o&&(i.tree_widget.selected_node=e),!0}))},t.prototype.getCookieName=function(){return"string"==typeof this.tree_widget.options.saveState?this.tree_widget.options.saveState:"tree"},t}(),c=function(){function e(e){this.tree_widget=e}return e.prototype.selectNode=function(e,t){var n;if(this.tree_widget.options.selectable){if(this.tree_widget.selected_node&&(this.tree_widget._getNodeElementForNode(this.tree_widget.selected_node).deselect(),this.tree_widget.selected_node=null),e&&(this.tree_widget._getNodeElementForNode(e).select(),this.tree_widget.selected_node=e,t))for(n=this.tree_widget.selected_node.parent;n;)n.is_open||this.tree_widget.openNode(n,!0),n=n.parent;if(this.tree_widget.options.saveState)return this.tree_widget.save_state_handler.saveState()}},e.prototype.selectCurrentNode=function(){var e;if(this.tree_widget.selected_node&&(e=this.tree_widget._getNodeElementForNode(this.tree_widget.selected_node)))return e.select()},e}(),n=function(){function t(e){this.tree_widget=e,this.hovered_area=null,this.$ghost=null,this.hit_areas=[],this.is_dragging=!1}return t.prototype.mouseCapture=function(t){var n,r;return n=e(t.target),this.tree_widget.options.onIsMoveHandle&&!this.tree_widget.options.onIsMoveHandle(n)?null:((r=this.tree_widget._getNodeElement(n))&&this.tree_widget.options.onCanMove&&(this.tree_widget.options.onCanMove(r.node)||(r=null)),this.current_item=r,null!==this.current_item)},t.prototype.mouseStart=function(e){var t,n,o;return this.refreshHitAreas(),t=(o=this.getOffsetFromEvent(e))[0],n=o[1],this.drag_element=new r(this.current_item.node,t,n,this.tree_widget.element),this.is_dragging=!0,this.current_item.$element.addClass("moving"),!0},t.prototype.mouseDrag=function(e){var t,n;return this.drag_element.move(e.pageX,e.pageY),(t=this.findHoveredArea(e.pageX,e.pageY))&&this.tree_widget.options.onCanMoveTo&&(n=p.getName(t.position),this.tree_widget.options.onCanMoveTo(this.current_item.node,t.node,n)||(t=null)),t?this.hovered_area!==t&&(this.hovered_area=t,this.updateDropHint()):(this.removeDropHint(),this.removeHover(),this.stopOpenFolderTimer()),!0},t.prototype.mouseStop=function(){return this.moveItem(),this.clear(),this.removeHover(),this.removeDropHint(),this.removeHitAreas(),this.current_item.$element.removeClass("moving"),this.is_dragging=!1,!1},t.prototype.getOffsetFromEvent=function(t){var n;return n=e(t.target).offset(),[t.pageX-n.left,t.pageY-n.top]},t.prototype.refreshHitAreas=function(){return this.removeHitAreas(),this.generateHitAreas()},t.prototype.removeHitAreas=function(){return this.hit_areas=[]},t.prototype.clear=function(){return this.drag_element.remove(),this.drag_element=null},t.prototype.removeDropHint=function(){if(this.previous_ghost)return this.previous_ghost.remove()},t.prototype.removeHover=function(){return this.hovered_area=null},t.prototype.generateHitAreas=function(){var t,n,r,o,i,s,u,a,h,d,l,c=this;return l=[],d=0,n=function(e){return e.offset().top},t=function(e,t,n){return l.push({top:n,node:e,position:t}),d=n},r=function(e){var t,n,r,o,i;for(r=-1,t=[],o=0,i=l.length;o<i;o++)(n=l[o]).top!==r&&(t.length&&e(t,r,n.top),r=n.top,t=[]),t.push(n);return e(t,r,c.tree_widget.element.offset().top+c.tree_widget.element.height())},u=function(e,r,o){var i;return i=n(o),e===c.current_item.node?t(e,p.NONE,i):t(e,p.INSIDE,i),r===c.current_item.node||e===c.current_item.node?t(e,p.NONE,i):t(e,p.AFTER,i)},a=function(e,r){return e!==c.current_item.node&&(e.children[0]!==c.current_item.node&&t(e,p.INSIDE,n(r)),!0)},o=function(e,n,r){return e===c.current_item.node||n===c.current_item.node?t(e,p.NONE,d):t(e,p.AFTER,d)},i=function(e,r,o){var i;return i=n(o),e===c.current_item.node?t(e,p.NONE,i):(t(e,p.INSIDE,i),r!==c.current_item.node?t(e,p.AFTER,i):void 0)},s=function(r,o){if(r!==c.current_item.node)return t(r,p.BEFORE,n(e(r.element)))},this.iterateVisibleNodes(u,a,i,o,s),h=[],r((function(e,t,n){var r,o,i,s,u;for(r=(n-t)/e.length,o=t,s=0,u=e.length;s<u;s++)i=e[s],h.push({top:o,bottom:o+r,node:i.node,position:i.position}),o+=r;return null})),this.hit_areas=h},t.prototype.iterateVisibleNodes=function(t,n,r,o,i){var s,u;return s=!0,(u=function(a,h){var d,p,l,c,f,_,m;if(c=(a.is_open||!a.element)&&a.hasChildren(),a.element){if(!(d=e(a.element)).is(":visible"))return;s&&(i(a,d),s=!1),a.hasChildren()?a.is_open?n(a,d)||(c=!1):r(a,h,d):t(a,h,d)}if(c){for(p=a.children.length,l=f=0,_=(m=a.children).length;f<_;l=++f)m[l],u(a.children[l],l===p-1?null:a.children[l+1]);if(a.is_open)return o(a,h,d)}})(this.tree_widget.tree)},t.prototype.findHoveredArea=function(e,t){var n,r,o,i,s;if(e<(s=this.tree_widget.element.offset()).left||t<s.top||e>s.left+this.tree_widget.element.width()||t>s.top+this.tree_widget.element.height())return null;for(o=0,r=this.hit_areas.length;o<r;)if(i=o+r>>1,t<(n=this.hit_areas[i]).top)r=i;else{if(!(t>n.bottom))return n;o=i+1}return null},t.prototype.updateDropHint=function(){var e,t;if(this.stopOpenFolderTimer(),this.hovered_area)return(e=this.hovered_area.node).hasChildren()&&!e.is_open&&this.hovered_area.position===p.INSIDE&&this.startOpenFolderTimer(e),this.removeDropHint(),t=this.tree_widget._getNodeElementForNode(this.hovered_area.node),this.previous_ghost=t.addDropHint(this.hovered_area.position)},t.prototype.startOpenFolderTimer=function(e){var t,n=this;return t=function(){return n.tree_widget._getNodeElementForNode(e).open((function(){return n.refreshHitAreas(),n.updateDropHint()}))},this.open_folder_timer=setTimeout(t,500)},t.prototype.stopOpenFolderTimer=function(){if(this.open_folder_timer)return clearTimeout(this.open_folder_timer),this.open_folder_timer=null},t.prototype.moveItem=function(){var t,n,r,o,i,s,u=this;if(this.hovered_area&&this.hovered_area.position!==p.NONE&&(r=this.current_item.node,s=this.hovered_area.node,o=this.hovered_area.position,i=r.parent,o===p.INSIDE&&(this.hovered_area.node.is_open=!0),t=function(){return u.tree_widget.tree.moveNode(r,s,o),u.tree_widget.element.empty(),u.tree_widget._refreshElements()},(n=e.Event("tree.move")).move_info={moved_node:r,target_node:s,position:p.getName(o),previous_parent:i,do_move:t},this.tree_widget.element.trigger(n),!n.isDefaultPrevented()))return t()},t}(),this.Tree.Node=h}).call(this);